{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport axios from \"axios\";\nimport { setSessionData, makeOnlyConnectionRequest, addSetToSelection, setStepperSteps, setEndpoint, setBaseUrl, setServerSessionId, completeDIDAuth, makeSealSession, makeSealSessionWithDIDConnecetionRequest, setSealSession, setEidasUriPort, setEidasRedirectUri } from \"../../../store\";\nimport { vcTypes } from \"../../../config/vcTypes\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport ConnectMobile from \"../../../components/ConnectMobile\";\nimport isMobile from \"../../../utils/isMobile\";\n\nvar IssueKYB = /*#__PURE__*/function (_React$Component) {\n  _inherits(IssueKYB, _React$Component);\n\n  var _super = _createSuper(IssueKYB);\n\n  function IssueKYB(props) {\n    var _this;\n\n    _classCallCheck(this, IssueKYB);\n\n    _this = _super.call(this, props);\n    _this.dispatch = props.dispatch;\n    _this.isFetching = props.isFetching;\n    _this.sessionData = props.sessionData;\n    _this.hasRequiredAttributes = props.sessionData !== null && props.sessionData !== undefined;\n    return _this;\n  }\n\n  _createClass(IssueKYB, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (this.props.sessionData && this.props.sessionData.eidas) {\n        //TODO clean this up\n        var toSelect = [this.props.sessionData.eidas];\n        this.props.setEidasToSelection(toSelect); ///\n      }\n\n      if (!this.props.DID) {\n        //if DID auth has not been completed\n        this.props.makeConnectionRequest(this.props.sealSession, this.props.baseUrl, \"eidas\", isMobile());\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      if (this.props.DID & !this.hasRequiredAttributes) {// //if DID auth is completed\n        // // register the callbackUri to the SessionManager\n        // let postUrl = this.props.baseUrl\n        //   ? `${this.props.baseUrl}seal/update-session`\n        //   : \"/seal/update-session\";\n        // axios\n        //   .post(postUrl, {\n        //     sessionId: this.props.sealSession,\n        //     variableName: \"ClientCallbackAddr\",\n        //     variableValue: this.props.eidasRedirectUri,\n        //   })\n        //   .then((data) => {\n        //     console.log(\"eidas.js:: session updated\");\n        //   });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var stepNumber = this.props.vcSent ? 2 : !this.props.DID ? 0 : this.hasRequiredAttributes ? 2 : 1;\n      var stepperSteps = [{\n        title: \"Pair your wallet\"\n      }, {\n        title: 'Authenticate over \"eIDAS-eID\"'\n      }, {\n        title: \"Request Issuance\"\n      }];\n\n      if (this.props.qrData && isMobile() && !this.props.DID) {\n        return __jsx(\"div\", null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n          steps: stepperSteps,\n          activeNum: stepNumber\n        }))), __jsx(ConnectMobile, {\n          baseUrl: this.props.baseUrl,\n          qrData: this.props.qrData,\n          DID: this.props.DID,\n          uuid: this.props.uuid,\n          serverSessionId: this.props.serverSessionId,\n          sealSession: this.props.sealSession\n        }));\n      }\n\n      var issueVCBut = __jsx(IssueVCButton, {\n        hasRequiredAttributes: this.hasRequiredAttributes // vcIssuanceEndpoint={\"/issueVCSecure\"}\n        ,\n        baseUrl: this.props.baseUrl // user attributes are not required as they are already in the backend\n        // only the type of the VC should be provided here\n        // vcAttributes={this.props.userSelection}\n        ,\n        uuid: this.props.sealSession,\n        vcType: vcTypes.eidas\n      });\n\n      var eidasCard = __jsx(Card, {\n        className: \"text-center\",\n        style: {\n          marginTop: \"2rem\"\n        }\n      }, __jsx(Card.Header, null, \"Issue an eIDAS based Verifiable Credential\"), __jsx(Card.Body, null, __jsx(Card.Title, null, this.hasRequiredAttributes ? \"Credentials Issuance is ready!\" : \"Please authenticate to the required data sources\"), __jsx(Card.Text, null, \"Once you have authenticated through the required data sources, click the \\\"Issue\\\" button to generate and receive your VC .\"), __jsx(Container, null, __jsx(Row, null, __jsx(Col, null, issueVCBut)))));\n\n      var result = __jsx(PairOrCard, {\n        qrData: this.props.qrData,\n        DID: this.props.DID,\n        baseUrl: this.props.baseUrl,\n        uuid: this.props.uuid,\n        serverSessionId: this.props.serverSessionId,\n        card: eidasCard,\n        vcSent: this.props.vcSent,\n        sealSession: this.props.sealSession,\n        credQROffer: this.props.credQROffer\n      });\n\n      return __jsx(\"div\", null, __jsx(Row, null, __jsx(Col, null, __jsx(MyStepper, {\n        steps: stepperSteps,\n        activeNum: stepNumber\n      }))), result);\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n        var reduxStore, req, userSessionData, DIDOk, sessionId, baseUrl;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                reduxStore = _ref.reduxStore, req = _ref.req;\n\n                if (false) {\n                  userSessionData = req.session.userData;\n                  reduxStore.dispatch(setEndpoint(req.session.endpoint));\n                  baseUrl = req.session.baseUrl ? \"/\".concat(req.session.baseUrl, \"/\") : \"\";\n                  reduxStore.dispatch(setBaseUrl(baseUrl));\n                  reduxStore.dispatch(setServerSessionId(req.session.sessionId));\n                  DIDOk = req.session.DID;\n                  sessionId = req.session.sessionId;\n                } //this way the userSessionData gets set in all settings\n\n\n                if (userSessionData) {\n                  reduxStore.dispatch(setSessionData(userSessionData));\n                }\n\n                if (DIDOk) {\n                  reduxStore.dispatch(completeDIDAuth(sessionId));\n                }\n\n                if (sessionId) {\n                  reduxStore.dispatch(setSealSession(sessionId));\n                } //returned value here is getting mered with the mapstatetoprops\n                // mapstatetoprops overrides these values if they match\n\n\n                return _context.abrupt(\"return\", {\n                  sessionData: userSessionData,\n                  qrData: reduxStore.getState().qrData,\n                  vcSent: false,\n                  sealSession: reduxStore.getState().sealSession\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return IssueKYB;\n}(React.Component);\n\nfunction mapStateToProps(state) {\n  return {\n    isFetching: state.fetching,\n    qrData: state.qrData,\n    sessionData: state.sessionData,\n    userSelection: state.userSelection,\n    // the attributes selected by the user to be included in a VC,\n    baseUrl: state.baseUrl,\n    DID: state.DID,\n    serverSessionId: state.serverSessionId,\n    uuid: state.uuid,\n    vcSent: state.vcSent,\n    sealSession: state.sealSession,\n    eidasUri: state.eidasUri,\n    eidasPort: state.eidasPort,\n    endpoint: state.endpoint,\n    eidasRedirectUri: state.eidasRedirectUri,\n    credQROffer: state.credQROffer\n  };\n}\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setEidasToSelection: function setEidasToSelection(set) {\n      dispatch(addSetToSelection(set));\n    },\n    setSteps: function setSteps(steps) {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: function setEndPoint(endpont) {\n      dispatch(setEndpoint(endpoint));\n    },\n    makeConnectionRequest: function makeConnectionRequest(sealSession, baseUrl, vcType, isMobile) {\n      dispatch(makeOnlyConnectionRequest(sealSession, baseUrl, vcType, isMobile));\n    },\n    didAuthOK: function didAuthOK(uuid) {\n      dispatch(completeDIDAuth(uuid));\n    },\n    startSealSession: function startSealSession(baseUrl) {\n      dispatch(makeSealSession(baseUrl));\n    },\n    startSealSessionAndDidAuth: function startSealSessionAndDidAuth(baseUrl, vcType, isMobile) {\n      dispatch(makeSealSessionWithDIDConnecetionRequest(baseUrl, vcType, isMobile));\n    },\n    setTheSealSession: function setTheSealSession(sessionId) {\n      dispatch(setSealSession(sessionId));\n    },\n    setEidas: function setEidas(uri, data) {\n      dispatch(setEidasUriPort(uri, data));\n    },\n    setEidasRedirect: function setEidasRedirect(uri) {\n      dispatch(setEidasRedirectUri(uri));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IssueKYB);","map":{"version":3,"sources":["/home/ni/code/js/grids-DC/pages/vc/issue/kyb.js"],"names":["React","axios","setSessionData","makeOnlyConnectionRequest","addSetToSelection","setStepperSteps","setEndpoint","setBaseUrl","setServerSessionId","completeDIDAuth","makeSealSession","makeSealSessionWithDIDConnecetionRequest","setSealSession","setEidasUriPort","setEidasRedirectUri","vcTypes","Layout","connect","Button","Row","Col","Card","Container","MyStepper","HomeButton","IssueVCButton","PairOrCard","ConnectMobile","isMobile","IssueKYB","props","dispatch","isFetching","sessionData","hasRequiredAttributes","undefined","eidas","toSelect","setEidasToSelection","DID","makeConnectionRequest","sealSession","baseUrl","stepNumber","vcSent","stepperSteps","title","qrData","uuid","serverSessionId","issueVCBut","eidasCard","marginTop","result","credQROffer","reduxStore","req","userSessionData","session","userData","endpoint","sessionId","DIDOk","getState","Component","mapStateToProps","state","fetching","userSelection","eidasUri","eidasPort","eidasRedirectUri","mapDispatchToProps","set","setSteps","steps","setEndPoint","endpont","vcType","didAuthOK","startSealSession","startSealSessionAndDidAuth","setTheSealSession","setEidas","uri","data","setEidasRedirect"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport axios from \"axios\";\nimport {\n  setSessionData,\n  makeOnlyConnectionRequest,\n  addSetToSelection,\n  setStepperSteps,\n  setEndpoint,\n  setBaseUrl,\n  setServerSessionId,\n  completeDIDAuth,\n  makeSealSession,\n  makeSealSessionWithDIDConnecetionRequest,\n  setSealSession,\n  setEidasUriPort,\n  setEidasRedirectUri,\n} from \"../../../store\";\nimport { vcTypes } from \"../../../config/vcTypes\";\nimport Layout from \"../../../components/Layout\";\nimport { connect } from \"react-redux\";\nimport { Button, Row, Col, Card, Container } from \"react-bootstrap\";\nimport MyStepper from \"../../../components/Stepper\";\nimport HomeButton from \"../../../components/HomeButton\";\nimport IssueVCButton from \"../../../components/IssueVCButton\";\nimport PairOrCard from \"../../../components/PairOrCard\";\nimport ConnectMobile from \"../../../components/ConnectMobile\";\nimport isMobile from \"../../../utils/isMobile\";\n\nclass IssueKYB extends React.Component {\n  constructor(props) {\n    super(props);\n    this.dispatch = props.dispatch;\n    this.isFetching = props.isFetching;\n    this.sessionData = props.sessionData;\n    this.hasRequiredAttributes =\n      props.sessionData !== null &&\n      props.sessionData !== undefined ;\n  }\n\n  static async getInitialProps({ reduxStore, req }) {\n    let userSessionData;\n    let DIDOk;\n    let sessionId;\n    if (typeof window === \"undefined\") {\n      userSessionData = req.session.userData;\n      reduxStore.dispatch(setEndpoint(req.session.endpoint));\n      let baseUrl = req.session.baseUrl ? `/${req.session.baseUrl}/` : \"\";\n      reduxStore.dispatch(setBaseUrl(baseUrl));\n      reduxStore.dispatch(setServerSessionId(req.session.sessionId));\n      DIDOk = req.session.DID;\n      sessionId = req.session.sessionId;\n    }\n\n    //this way the userSessionData gets set in all settings\n    if (userSessionData) {\n      reduxStore.dispatch(setSessionData(userSessionData));\n    }\n    if (DIDOk) {\n      reduxStore.dispatch(completeDIDAuth(sessionId));\n    }\n    if (sessionId) {\n      reduxStore.dispatch(setSealSession(sessionId));\n    }\n\n    //returned value here is getting mered with the mapstatetoprops\n    // mapstatetoprops overrides these values if they match\n    return {\n      sessionData: userSessionData,\n      qrData: reduxStore.getState().qrData,\n      vcSent: false,\n      sealSession: reduxStore.getState().sealSession,\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.sessionData && this.props.sessionData.eidas) {\n      //TODO clean this up\n      let toSelect = [this.props.sessionData.eidas];\n      this.props.setEidasToSelection(toSelect);\n      ///\n    }\n\n    if (!this.props.DID) {\n      //if DID auth has not been completed\n      this.props.makeConnectionRequest(\n        this.props.sealSession,\n        this.props.baseUrl,\n        \"eidas\",\n        isMobile()\n      );\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.DID & !this.hasRequiredAttributes) {\n      // //if DID auth is completed\n      // // register the callbackUri to the SessionManager\n      // let postUrl = this.props.baseUrl\n      //   ? `${this.props.baseUrl}seal/update-session`\n      //   : \"/seal/update-session\";\n      // axios\n      //   .post(postUrl, {\n      //     sessionId: this.props.sealSession,\n      //     variableName: \"ClientCallbackAddr\",\n      //     variableValue: this.props.eidasRedirectUri,\n      //   })\n      //   .then((data) => {\n      //     console.log(\"eidas.js:: session updated\");\n      //   });\n    }\n  }\n\n\n\n  render() {\n    let stepNumber = this.props.vcSent\n      ? 2\n      : !this.props.DID\n      ? 0\n      : this.hasRequiredAttributes\n      ? 2\n      : 1;\n    let stepperSteps = [\n      { title: \"Pair your wallet\" },\n      { title: 'Authenticate over \"eIDAS-eID\"' },\n      { title: \"Request Issuance\" },\n    ];\n\n    if (this.props.qrData && isMobile() && !this.props.DID) {\n      return (\n        <div>\n          <Row>\n            <Col>\n              <MyStepper steps={stepperSteps} activeNum={stepNumber} />\n            </Col>\n          </Row>\n          <ConnectMobile\n            baseUrl={this.props.baseUrl}\n            qrData={this.props.qrData}\n            DID={this.props.DID}\n            uuid={this.props.uuid}\n            serverSessionId={this.props.serverSessionId}\n            sealSession={this.props.sealSession}\n          />\n        </div>\n      );\n    }\n\n   \n    let issueVCBut = (\n      <IssueVCButton\n        hasRequiredAttributes={this.hasRequiredAttributes}\n        // vcIssuanceEndpoint={\"/issueVCSecure\"}\n        baseUrl={this.props.baseUrl}\n        // user attributes are not required as they are already in the backend\n        // only the type of the VC should be provided here\n        // vcAttributes={this.props.userSelection}\n        uuid={this.props.sealSession}\n        vcType={vcTypes.eidas}\n      />\n    );\n\n    let eidasCard = (\n      <Card className=\"text-center\" style={{ marginTop: \"2rem\" }}>\n        <Card.Header>Issue an eIDAS based Verifiable Credential</Card.Header>\n        <Card.Body>\n          <Card.Title>\n            {this.hasRequiredAttributes\n              ? \"Credentials Issuance is ready!\"\n              : \"Please authenticate to the required data sources\"}\n          </Card.Title>\n          <Card.Text>\n            Once you have authenticated through the required data sources, click\n            the \"Issue\" button to generate and receive your VC .\n          </Card.Text>\n          <Container>\n            <Row>\n              <Col>{issueVCBut}</Col>\n            </Row>\n          </Container>\n        </Card.Body>\n        {/* <Card.Footer className=\"text-muted\">2 days ago</Card.Footer> */}\n      </Card>\n    );\n\n    let result = (\n      <PairOrCard\n        qrData={this.props.qrData}\n        DID={this.props.DID}\n        baseUrl={this.props.baseUrl}\n        uuid={this.props.uuid}\n        serverSessionId={this.props.serverSessionId}\n        card={eidasCard}\n        vcSent={this.props.vcSent}\n        sealSession={this.props.sealSession}\n        credQROffer={this.props.credQROffer}\n      />\n    );\n\n    return (\n      <div>\n        <Row>\n          <Col>\n            <MyStepper steps={stepperSteps} activeNum={stepNumber} />\n          </Col>\n        </Row>\n        {result}\n\n       \n      </div>\n    );\n  }\n}\nfunction mapStateToProps(state) {\n  return {\n    isFetching: state.fetching,\n    qrData: state.qrData,\n    sessionData: state.sessionData,\n    userSelection: state.userSelection, // the attributes selected by the user to be included in a VC,\n    baseUrl: state.baseUrl,\n    DID: state.DID,\n    serverSessionId: state.serverSessionId,\n    uuid: state.uuid,\n    vcSent: state.vcSent,\n    sealSession: state.sealSession,\n    eidasUri: state.eidasUri,\n    eidasPort: state.eidasPort,\n    endpoint: state.endpoint,\n    eidasRedirectUri: state.eidasRedirectUri,\n    credQROffer: state.credQROffer,\n  };\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    setEidasToSelection: (set) => {\n      dispatch(addSetToSelection(set));\n    },\n    setSteps: (steps) => {\n      dispatch(setStepperSteps(steps));\n    },\n    setEndPoint: (endpont) => {\n      dispatch(setEndpoint(endpoint));\n    },\n    makeConnectionRequest: (sealSession, baseUrl, vcType, isMobile) => {\n      dispatch(\n        makeOnlyConnectionRequest(sealSession, baseUrl, vcType, isMobile)\n      );\n    },\n    didAuthOK: (uuid) => {\n      dispatch(completeDIDAuth(uuid));\n    },\n    startSealSession: (baseUrl) => {\n      dispatch(makeSealSession(baseUrl));\n    },\n    startSealSessionAndDidAuth: (baseUrl, vcType, isMobile) => {\n      dispatch(\n        makeSealSessionWithDIDConnecetionRequest(baseUrl, vcType, isMobile)\n      );\n    },\n    setTheSealSession: (sessionId) => {\n      dispatch(setSealSession(sessionId));\n    },\n    setEidas: (uri, data) => {\n      dispatch(setEidasUriPort(uri, data));\n    },\n\n    setEidasRedirect: (uri) => {\n      dispatch(setEidasRedirectUri(uri));\n    },\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IssueKYB);\n"]},"metadata":{},"sourceType":"module"}