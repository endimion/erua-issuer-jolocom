{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createStore, applyMiddleware } from \"redux\";\nimport { composeWithDevTools } from \"redux-devtools-extension\";\nimport thunkMiddleware from \"redux-thunk\";\nimport axios from \"axios\";\nimport UserSelection from \"./model/userSelection\";\nvar initialState = {\n  count: 0,\n  qrData: null,\n  fetching: false,\n  requestSignature: null,\n  sessionData: null,\n  serverSessionId: null,\n  uuid: null,\n  vcSent: false,\n  userSelection: [],\n  // the attributes selected by the user to be included in a VC,\n  endpoint: null,\n  // the backend server url root.\n  cardIndex: 1,\n  stepperSteps: [],\n  baseUrl: \"\",\n  DID: false,\n  //boolean, denoting that DID connection response has been received for this session\n  sealSession: \"\",\n  didAuthCallback: \"\",\n  // callback address set by the caller to redirect to after DID auth,\n  eidasUri: \"\",\n  eidasPort: \"\",\n  eidasRedirectUri: \"\",\n  edugainUri: \"\",\n  edugainPort: \"\",\n  edugainRedirectUri: \"\",\n  vcFailed: false,\n  credQROffer: \"\"\n};\nexport var actionTypes = {\n  GET_QR_AUTH_RESPONSE: \"GET_QR_AUTH_RESPONSE\",\n  MAKE_QR_AUTH_REQUEST: \"MAKE_QR_AUTH_REQUEST\",\n  MAKE_VC_QR_REQUEST: \"MAKE_VC_QR_REQUEST\",\n  //make a request to generate a VC based on the selected attributes\n  GET_VC_QR_RESPONSE: \"GET_VC_QR_REQUEST\",\n  SET_ATTRIBUTES_SELECTION: \"SET_ATTRIBUTES_SELECTION\",\n  //adds an array as the user  selected attirubtes\n  ADD_SET_TO_ATTRIBUTES_SELECTION: \"ADD_SET_TO_ATTRIBUTES_SELECTION\",\n  //adds the payload to the userSelection\n  ADD_ATTRIBUTES_TO_SELECTION: \"ADD_ATTRIBUTES_TO_SELECTION\",\n  //adds the payload to the userSelection\n  // the selection takes place using identifiers from the session\n  // that are meaningful to the backend\n  REMOVE_ATTRIBUTE_FROM_SELECTION: \"REMOVE_ATTRIBUTE_FROM_SELECTION\",\n  SET_SERVER_SESSION_DATA: \"SET_SERVER_SESSION_DATA\",\n  SET_SERVER_SESSION_ID: \"SET_SERVER_SESSION_ID\",\n  VC_SENT_TO_USER: \"VC_SENT_TO_USER\",\n  SET_ENDPOINT: \"SET_END_POINT\",\n  //\n  INCREASE_CARD_INDEX: \"INCREASE_CARD_INDEX\",\n  DECREASE_CARD_INDEX: \"DECREASE_CARD_INDEX\",\n  //\n  SET_STEPPER_STEPS: \"SET_STEPPER_STEPS\",\n  //\n  SET_BASE_URL: \"SET_BASE_URL\",\n  //\n  SET_DID_TRUE: \"SES_DID_TRUE\",\n  SET_SEAL_SESSION: \"SET_SEAL_SESSION\",\n  SET_CALLBACK: \"SET_CALLBACK\",\n  SET_EIDAS_URI_PORT: \"SET_EIDAS_URI_PORT\",\n  SET_EIDAS_REDIRECT_URI: \"SET_EIDAS_REDIRECT_URI\",\n  SET_EDUGAIN_URI_PORT: \"SET_EDUGAIN_URI_PORT\",\n  SET_EDUGAIN_REDIRECT_URI: \"SET_EDUGAIN_REDIRECT_URI\",\n  VC_ISSUE_FAILED: \"VC_ISSUE_FAILED\",\n  JOLO_VC_GENERATED: \"JOLO_VC_GENERATED\"\n}; // REDUCERS\n\nvar reducer = function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case actionTypes.JOLO_VC_GENERATED:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        credQROffer: action.data\n      });\n\n    case actionTypes.VC_ISSUE_FAILED:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        vcFailed: true\n      });\n\n    case actionTypes.SET_EDUGAIN_REDIRECT_URI:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        edugainRedirectUri: action.data\n      });\n\n    case actionTypes.SET_EDUGAIN_URI_PORT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        edugainUri: action.data.uri,\n        edugainPort: action.data.port\n      });\n\n    case actionTypes.SET_EIDAS_REDIRECT_URI:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        eidasRedirectUri: action.data\n      });\n\n    case actionTypes.SET_EIDAS_URI_PORT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        eidasUri: action.data.uri,\n        eidasPort: action.data.port\n      });\n\n    case actionTypes.SET_CALLBACK:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        didAuthCallback: action.data\n      });\n\n    case actionTypes.SET_SEAL_SESSION:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        sealSession: action.data\n      });\n\n    case actionTypes.SET_DID_TRUE:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        DID: true,\n        uuid: action.data\n      });\n\n    case actionTypes.SET_BASE_URL:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        baseUrl: action.data\n      });\n\n    case actionTypes.SET_STEPPER_STEPS:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        stepperSteps: action.data\n      });\n\n    case actionTypes.INCREASE_CARD_INDEX:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        cardIndex: state.cardIndex + 1\n      });\n\n    case actionTypes.DECREASE_CARD_INDEX:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        cardIndex: state.cardIndex - 1\n      });\n\n    case actionTypes.SET_ENDPOINT:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        endpoint: action.data\n      });\n\n    case actionTypes.VC_SENT_TO_USER:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        vcSent: true\n      });\n\n    case actionTypes.SET_SERVER_SESSION_DATA:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        sessionData: action.data // userEduGain: action.data.eduGAIN,\n        // userEidas: action.data.eidas,\n\n      });\n\n    case actionTypes.GET_QR_AUTH_RESPONSE:\n      // console.log(action.data);\n      return _objectSpread(_objectSpread({}, state), {}, {\n        fetching: false,\n        qrData: action.data.qr,\n        uuid: action.data.uuid,\n        requestSignature: action.data.signature\n      });\n\n    case actionTypes.SET_ATTRIBUTES_SELECTION:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        userSelection: action.data\n      });\n\n    case actionTypes.MAKE_QR_AUTH_REQUEST:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        fetching: true,\n        vcSent: false\n      });\n\n    case actionTypes.ADD_ATTRIBUTES_TO_SELECTION:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          userSelection: [].concat(_toConsumableArray(state.userSelection), [action.data])\n        });\n      }\n\n    case actionTypes.ADD_SET_TO_ATTRIBUTES_SELECTION:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          userSelection: [].concat(_toConsumableArray(state.userSelection), _toConsumableArray(action.data))\n        });\n      }\n\n    case actionTypes.SET_SERVER_SESSION_ID:\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          serverSessionId: action.data\n        });\n      }\n\n    case actionTypes.REMOVE_ATTRIBUTE_FROM_SELECTION:\n      var newSelection = _toConsumableArray(state.userSelection.filter(function (el, ind) {\n        return ind !== action.index;\n      }));\n\n      return _objectSpread(_objectSpread({}, state), {}, {\n        userSelection: newSelection\n      });\n\n    default:\n      return state;\n  }\n}; // ACTIONS\n\n\nexport function loginClicked() {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.MAKE_QR_AUTH_REQUEST\n    });\n    axios.get(\"connectionRequest\").then(function (data) {\n      console.log(\"got the data form the server\");\n      console.log(data.data);\n      return dispatch({\n        type: actionTypes.GET_QR_AUTH_RESPONSE,\n        data: data.data\n      });\n    });\n  }; // return dispatch => axios.get('https://38da089e.ngrok.io/connectionRequest')\n  //     .then(({ data }) => data)\n  //     .then(items => dispatch({ type: actionTypes.MAKE_QR_AUTH_REQUEST, items }))\n  //     .then( () =>{\n  //       console.log(\"got there\")\n  //         return dispatch({ type: actionTypes.GET_QR_AUTH_RESPONSE, data:'these are my awesome data' })\n  //     });\n} // export function setDIDTrue() {\n//   return dispatch => {\n//     dispatch({\n//       type: actionTypes.SET_DID_TRUE\n//     });\n//   };\n// }\n\nexport function setStepperSteps(steps) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_STEPPER_STEPS,\n      data: steps\n    });\n  };\n}\nexport function setBaseUrl(baseUrl) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_BASE_URL,\n      data: baseUrl\n    });\n  };\n}\nexport function startSession(sessionId, sessionStatus) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.START_SESSION,\n      data: {\n        sessionId: sessionId,\n        status: sessionStatus\n      }\n    });\n  };\n}\nexport function setServerSessionId(sessionId) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_SERVER_SESSION_ID,\n      data: sessionId\n    });\n  };\n}\nexport function setSessionData(sessionData) {\n  return function (dispatch) {\n    console.log(\"store.js setSessionData called with::\");\n    console.log(sessionData);\n    dispatch({\n      type: actionTypes.SET_SERVER_SESSION_DATA,\n      data: sessionData\n    });\n  };\n}\nexport function setUserAttributeSelection(selectedAttributes) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_ATTRIBUTES_SELECTION,\n      data: selectedAttributes\n    });\n  };\n}\nexport function updateSession(sessionStatus) {\n  return function (dispatch) {\n    var toDispatch = {\n      type: actionTypes.UPDATE_SESSION,\n      data: {\n        status: sessionStatus\n      }\n    };\n    dispatch(toDispatch);\n  };\n}\nexport function setEndpoint(endpoint) {\n  console.log(\"store.js setting endpoint to \" + endpoint);\n  return function (dispatch) {\n    var toDispatch = {\n      type: actionTypes.SET_ENDPOINT,\n      data: endpoint\n    };\n    dispatch(toDispatch);\n  };\n}\nexport function addToSelection(index, source) {\n  // console.log(`store.js:: will add to seleciton ${index} , ${source}`);\n  var data = new UserSelection(index, source);\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.ADD_ATTRIBUTES_TO_SELECTION,\n      data: data\n    });\n  };\n}\nexport function addSetToSelection(setArray) {\n  var data = [];\n  setArray.forEach(function (attrObj) {\n    Object.keys(attrObj).map(function (key) {\n      // console.log(`will fetch key ${key} from` )\n      data.push(new UserSelection(key, attrObj.source));\n      return new UserSelection(key, attrObj[key]);\n    });\n  });\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.ADD_SET_TO_ATTRIBUTES_SELECTION,\n      data: data\n    });\n  };\n}\nexport function removeFromSelection(index) {\n  // console.log(`store.js will remove from  seleciton ${index}`);\n  return function (dispatch) {\n    var toDispatch = {\n      type: actionTypes.REMOVE_ATTRIBUTE_FROM_SELECTION,\n      index: index\n    };\n    dispatch(toDispatch);\n  };\n}\nexport function vcSentToUser() {\n  return function (dispatch) {\n    var toDispatch = {\n      type: actionTypes.VC_SENT_TO_USER\n    };\n    dispatch(toDispatch);\n  };\n}\nexport function increaseCardIndex() {\n  // console.log(`store.js will remove from  seleciton ${index}`);\n  return function (dispatch) {\n    var toDispatch = {\n      type: actionTypes.INCREASE_CARD_INDEX\n    };\n    dispatch(toDispatch);\n  };\n}\nexport function decreaseCardIndex() {\n  // console.log(`store.js will remove from  seleciton ${index}`);\n  return function (dispatch) {\n    var toDispatch = {\n      type: actionTypes.DECREASE_CARD_INDEX\n    };\n    dispatch(toDispatch);\n  };\n}\nexport function requestVCgeneration(url, selectedAttributes, vcType) {\n  var isMobile = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.MAKE_QR_AUTH_REQUEST\n    });\n    var bodyFormData = new FormData();\n    bodyFormData.set(\"data\", selectedAttributes);\n    console.log(\"store.js - requestVCgeneration:: will make VC generation request\");\n    console.log(\"store.js - requestVCgeneration:: for the url \".concat(url)); // console.log(`store.js - requestVCgeneration:: with data`)\n    // console.log(selectedAttributes);\n    // console.log(isMobile);\n\n    axios.post(url, {\n      data: selectedAttributes,\n      vcType: vcType,\n      isMobile: isMobile\n    }).then(function (data) {\n      console.log(\"store.js- requestVCgeneration:: got the data form the server\");\n      console.log(data.data);\n      console.log(\"store.js- requestVCgeneration:: got vcType\");\n      console.log(vcType);\n      return dispatch({\n        type: actionTypes.GET_QR_AUTH_RESPONSE,\n        data: data.data,\n        vcType: vcType\n      });\n    });\n  };\n}\nexport function makeConnectionRequest() {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.MAKE_QR_AUTH_REQUEST\n    });\n    axios.post(\"/makeConnectionRequest\", {}).then(function (data) {\n      console.log(\"store.js:: makeConnectionRequest got the data form the server\");\n      return dispatch({\n        type: actionTypes.GET_QR_AUTH_RESPONSE,\n        data: data.data\n      });\n    });\n  };\n}\nexport function completeDIDAuth(uuid) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_DID_TRUE,\n      data: uuid\n    });\n  };\n}\nexport function makeAndPushVC(url, selectedAttributes, vcType, sealSession) {\n  var isMobile = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  return function (dispatch) {\n    var bodyFormData = new FormData();\n    bodyFormData.set(\"data\", selectedAttributes);\n    console.log(\"store.js - makeAndPushVC:: will make VC generation request\");\n    console.log(\"store.js :: makeandpushVC:: \".concat(url, \", and \").concat(vcType));\n    axios.post(url, {\n      data: selectedAttributes,\n      sealSession: sealSession,\n      vcType: vcType,\n      isMobile: isMobile\n    }).then(function (data) {\n      console.log(\"store.js- makeAndPushVC:: got the data form the server\");\n      dispatch({\n        type: actionTypes.VC_SENT_TO_USER\n      });\n    })[\"catch\"](function (err) {\n      console.log(\"store.js- makeAndPushVC:: ERROR\");\n      console.log(err);\n      dispatch({\n        type: actionTypes.VC_ISSUE_FAILED\n      });\n    }); //TODO add here an action denoting that the VC was sent\n  };\n} // export function makeAndPushVCJolo(\n//   url,\n//   selectedAttributes,\n//   vcType,\n//   sealSession,\n//   isMobile = false\n// ) {\n//   return (dispatch) => {\n//     let bodyFormData = new FormData();\n//     bodyFormData.set(\"data\", selectedAttributes);\n//     axios\n//       .post(url, {\n//         data: selectedAttributes,\n//         sealSession: sealSession,\n//         vcType: vcType,\n//         isMobile: isMobile,\n//       })\n//       .then((resp) => {\n//         console.log(resp)\n//         dispatch({ type: actionTypes.JOLO_VC_GENERATED, data: resp.data.qr });\n//       })\n//       .catch((err) => {\n//         console.log(\"store.js- makeAndPushVC:: ERROR\");\n//         console.log(err);\n//         dispatch({ type: actionTypes.VC_ISSUE_FAILED });\n//       });\n//   };\n// }\n\nexport function requestVC(url, vcType, sealSession) {\n  var isMobile = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch) {\n    axios.post(url, {\n      sealSession: sealSession,\n      vcType: vcType,\n      isMobile: isMobile\n    }).then(function (resp) {\n      console.log(\"store.js requestVC_response\");\n      console.log(resp);\n      dispatch({\n        type: actionTypes.JOLO_VC_GENERATED,\n        data: resp.data.qr\n      });\n    })[\"catch\"](function (err) {\n      console.log(\"store.js- makeAndPushVC:: ERROR\");\n      console.log(err);\n      dispatch({\n        type: actionTypes.VC_ISSUE_FAILED\n      });\n    });\n  };\n}\nexport function setSealSession(sessionId) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_SEAL_SESSION,\n      data: sessionId\n    });\n  };\n}\nexport function makeSealSession(baseUrl) {\n  console.log(\"store:: makeSealSession\");\n  return function (dispatch) {\n    axios.post(\"\".concat(baseUrl, \"seal/start-session\"), {}).then(function (resp) {\n      console.log(\"store.js:: makeSealSession\"); // console.log(resp.data);\n\n      return dispatch({\n        type: actionTypes.SET_SEAL_SESSION,\n        data: resp.data\n      });\n    });\n  };\n}\nexport function makeOnlyConnectionRequest(sealSession, baseUrl) {\n  var vcType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"didAuth\";\n  var isMobile = arguments.length > 3 ? arguments[3] : undefined;\n  var postData = {\n    sealSession: sealSession,\n    vcType: vcType\n  };\n\n  if (isMobile) {\n    postData.isMobile = isMobile;\n  }\n\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.MAKE_QR_AUTH_REQUEST\n    });\n    axios.post(\"\".concat(baseUrl, \"onlyConnectionRequest\"), postData).then(function (data) {\n      console.log(\"store.js -- onlyConnectionRequest:: got the data form the server\");\n      return dispatch({\n        type: actionTypes.GET_QR_AUTH_RESPONSE,\n        data: data.data\n      });\n    });\n  };\n}\nexport function makeSealSessionWithDIDConnecetionRequest(baseUrl, vcType, isMobile) {\n  console.log(\"store.js:: makeSealSessionWithDIDConnecetionRequest  the base url is-->\".concat(baseUrl, \"<--\"));\n  return function (dispatch) {\n    var sessionId = \"\";\n    var postUrl = baseUrl ? \"\".concat(baseUrl, \"seal/start-session\") : \"/seal/start-session\";\n    axios.post(postUrl, {}).then(function (resp) {\n      sessionId = resp.data;\n      return dispatch({\n        type: actionTypes.SET_SEAL_SESSION,\n        data: resp.data\n      });\n    }).then(function (obj) {\n      // console.log(\"makeSealSessionWithDIDConnecetionRequest\")\n      console.log(\"isMobile? \".concat(isMobile));\n      var postUrl = baseUrl ? \"\".concat(baseUrl, \"makeConnectionRequest\") : \"/makeConnectionRequest\";\n      axios.post(postUrl, {\n        sealSession: sessionId,\n        baseUrl: baseUrl,\n        vcType: vcType,\n        isMobile: isMobile\n      }).then(function (data) {\n        return dispatch({\n          type: actionTypes.GET_QR_AUTH_RESPONSE,\n          data: data.data\n        });\n      });\n    });\n  };\n}\nexport function setDidCallback(callback) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_CALLBACK,\n      data: callback\n    });\n  };\n}\nexport function setEidasUriPort(uri, port) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_EIDAS_URI_PORT,\n      data: {\n        uri: uri,\n        port: port\n      }\n    });\n  };\n}\nexport function setEidasRedirectUri(uri) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_EIDAS_REDIRECT_URI,\n      data: uri\n    });\n  };\n}\nexport function setEdugainRedirectUri(uri) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_EDUGAIN_REDIRECT_URI,\n      data: uri\n    });\n  };\n}\nexport function setEdugainUriPort(uri, port) {\n  return function (dispatch) {\n    dispatch({\n      type: actionTypes.SET_EDUGAIN_URI_PORT,\n      data: {\n        uri: uri,\n        port: port\n      }\n    });\n  };\n}\nexport var initializeStore = function initializeStore() {\n  var preloadedState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  return createStore(reducer, preloadedState, composeWithDevTools(applyMiddleware(thunkMiddleware)));\n};","map":null,"metadata":{},"sourceType":"module"}